// Minified and Optimized Portfolio JavaScript - modern-script.min.js
document.addEventListener('DOMContentLoaded',function(){
const d=document,w=window,qs=d.querySelector.bind(d),qsa=d.querySelectorAll.bind(d);
let loader=qs('#loader'),cursor=qs('.cursor'),cursorFollower=qs('.cursor-follower'),themeToggle=qs('#theme-toggle'),navbar=qs('#navbar'),hamburger=qs('#hamburger'),navMenu=qs('#nav-menu'),backToTopBtn=qs('#backToTop'),heroBackground=qs('.hero-gradient');
const navLinks=qsa('.nav-link'),sections=qsa('section'),counters=qsa('.stat-number'),skillCircles=qsa('.progress-ring-circle'),filterBtns=qsa('.filter-btn'),workCards=qsa('.work-card'),buttons=qsa('.btn');

// Hide loader
w.addEventListener('load',()=>setTimeout(()=>loader&&loader.classList.add('hidden'),1000));

// AOS init
if(typeof AOS!=='undefined')AOS.init({duration:1000,easing:'ease-in-out',once:false,mirror:true});

// Custom cursor
if(cursor&&cursorFollower){
d.addEventListener('mousemove',e=>{
cursor.style.left=e.clientX+'px';
cursor.style.top=e.clientY+'px';
setTimeout(()=>{
cursorFollower.style.left=e.clientX+'px';
cursorFollower.style.top=e.clientY+'px';
},100);
});
qsa('a,button,.filter-btn').forEach(el=>{
el.addEventListener('mouseenter',()=>{
cursor.style.transform='translate(-50%,-50%) scale(2)';
cursorFollower.style.transform='translate(-50%,-50%) scale(1.5)';
});
el.addEventListener('mouseleave',()=>{
cursor.style.transform='translate(-50%,-50%) scale(1)';
cursorFollower.style.transform='translate(-50%,-50%) scale(1)';
});
});
}

// Particles
if(typeof particlesJS!=='undefined'){
particlesJS('particles-js',{
particles:{
number:{value:80,density:{enable:true,value_area:800}},
color:{value:'#667eea'},
shape:{type:'circle',stroke:{width:0,color:'#000000'}},
opacity:{value:0.5,random:false,anim:{enable:false,speed:1,opacity_min:0.1,sync:false}},
size:{value:3,random:true,anim:{enable:false,speed:40,size_min:0.1,sync:false}},
line_linked:{enable:true,distance:150,color:'#667eea',opacity:0.4,width:1},
move:{enable:true,speed:2,direction:'none',random:false,straight:false,out_mode:'out',bounce:false,attract:{enable:false,rotateX:600,rotateY:1200}}
},
interactivity:{
detect_on:'canvas',
events:{onhover:{enable:true,mode:'grab'},onclick:{enable:true,mode:'push'},resize:true},
modes:{grab:{distance:140,line_linked:{opacity:1}},push:{particles_nb:4}}
},
retina_detect:true
});
}

// Dark mode
const currentTheme=localStorage.getItem('theme');
if(currentTheme==='dark'){
d.body.classList.add('dark-mode');
themeToggle&&(themeToggle.innerHTML='<i class="fas fa-sun"></i>');
}
themeToggle&&themeToggle.addEventListener('click',()=>{
d.body.classList.toggle('dark-mode');
if(d.body.classList.contains('dark-mode')){
localStorage.setItem('theme','dark');
themeToggle.innerHTML='<i class="fas fa-sun"></i>';
}else{
localStorage.setItem('theme','light');
themeToggle.innerHTML='<i class="fas fa-moon"></i>';
}
});

// Navbar scroll & navigation
let ticking=false;
const updateScroll=()=>{
const scrollY=w.pageYOffset;
if(navbar){
if(scrollY>100)navbar.classList.add('scrolled');
else navbar.classList.remove('scrolled');
}
// Active link highlighting
let current='';
sections.forEach(section=>{
if(w.pageYOffset>=section.offsetTop-200)current=section.getAttribute('id');
});
navLinks.forEach(link=>{
link.classList.remove('active');
if(link.getAttribute('href')===`#${current}`)link.classList.add('active');
});
ticking=false;
};
w.addEventListener('scroll',()=>{
if(!ticking){
requestAnimationFrame(updateScroll);
ticking=true;
}
},{passive:true});

// Smooth scrolling
navLinks.forEach(link=>{
link.addEventListener('click',e=>{
e.preventDefault();
const target=qs(link.getAttribute('href'));
if(target){
w.scrollTo({top:target.offsetTop-80,behavior:'smooth'});
navMenu&&navMenu.classList.remove('active');
hamburger&&hamburger.classList.remove('active');
}
});
});

// Hamburger menu
hamburger&&hamburger.addEventListener('click',()=>{
hamburger.classList.toggle('active');
navMenu&&navMenu.classList.toggle('active');
});

// Typing animation
if(typeof Typed!=='undefined'){
new Typed('.typing-subtitle',{
strings:['Full Stack Developer','Freelance Engineer','Web Application Specialist','Mobile App Developer','Open Source Contributor'],
typeSpeed:50,backSpeed:30,backDelay:2000,loop:true
});
}

// Counter animation
const animateCounter=counter=>{
const target=+counter.getAttribute('data-target');
const increment=target/200;
const update=()=>{
const current=+counter.innerText;
if(current<target){
counter.innerText=Math.ceil(current+increment);
setTimeout(update,1);
}else counter.innerText=target;
};
update();
};

// Skill progress animation
const animateSkill=circle=>{
const progress=circle.getAttribute('data-progress');
const radius=40,circumference=2*Math.PI*radius;
const offset=circumference-(progress/100)*circumference;
circle.style.strokeDasharray=`${circumference} ${circumference}`;
circle.style.strokeDashoffset=circumference;
setTimeout(()=>circle.style.strokeDashoffset=offset,100);
};

// Unified intersection observer
const observer=new IntersectionObserver((entries)=>{
entries.forEach(entry=>{
if(entry.isIntersecting){
if(entry.target.classList.contains('stat-number'))animateCounter(entry.target);
if(entry.target.classList.contains('progress-ring-circle'))animateSkill(entry.target);
if(entry.target.classList.contains('section-title')||entry.target.classList.contains('section-subtitle')||entry.target.classList.contains('work-card')||entry.target.classList.contains('skill-item'))entry.target.classList.add('fade-in');
observer.unobserve(entry.target);
}
});
},{threshold:0.5});

// Observe elements
[...counters,...skillCircles,...qsa('.section-title,.section-subtitle,.work-card,.skill-item')].forEach(el=>observer.observe(el));

// Work filter
filterBtns.forEach(btn=>{
btn.addEventListener('click',()=>{
filterBtns.forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
const filter=btn.getAttribute('data-filter');
workCards.forEach(card=>{
if(filter==='all'||card.getAttribute('data-category')===filter){
card.style.display='block';
setTimeout(()=>{card.style.opacity='1';card.style.transform='scale(1)';},100);
}else{
card.style.opacity='0';card.style.transform='scale(0.8)';
setTimeout(()=>card.style.display='none',300);
}
});
});
});

// Back to top
backToTopBtn&&backToTopBtn.addEventListener('click',()=>w.scrollTo({top:0,behavior:'smooth'}));
w.addEventListener('scroll',()=>{
if(backToTopBtn)backToTopBtn.classList.toggle('show',w.pageYOffset>300);
},{passive:true});

// Parallax
w.addEventListener('scroll',()=>{
if(heroBackground)heroBackground.style.transform=`translateY(${w.pageYOffset*0.5}px)`;
},{passive:true});

// Button ripple effect
buttons.forEach(button=>{
button.addEventListener('mouseenter',function(e){
const x=e.clientX-e.target.offsetLeft,y=e.clientY-e.target.offsetTop;
const ripple=d.createElement('span');
ripple.style.left=`${x}px`;ripple.style.top=`${y}px`;ripple.classList.add('ripple');
this.appendChild(ripple);
setTimeout(()=>ripple.remove(),600);
});
});

// Mobile optimizations
const isTouchDevice='ontouchstart'in w||navigator.maxTouchPoints>0;
if(isTouchDevice){
d.body.classList.add('touch-device');
// Mobile navbar hide/show
let lastScrollY=0;
w.addEventListener('scroll',()=>{
const scrollY=w.pageYOffset;
if(navbar){
if(scrollY>lastScrollY&&scrollY>100)navbar.style.transform='translateY(-100%)';
else navbar.style.transform='translateY(0)';
}
lastScrollY=scrollY;
},{passive:true});

// Viewport height fix
const setVH=()=>d.documentElement.style.setProperty('--vh',`${w.innerHeight*0.01}px`);
setVH();
w.addEventListener('resize',setVH);
w.addEventListener('orientationchange',()=>setTimeout(setVH,500));

// Mobile work cards
workCards.forEach(card=>{
let touchStart=0,touchStartX=0,touchStartY=0;
card.addEventListener('touchstart',e=>{
touchStart=Date.now();
touchStartX=e.touches[0].clientX;
touchStartY=e.touches[0].clientY;
},{passive:true});
card.addEventListener('touchend',e=>{
const touchEnd=Date.now(),touchEndX=e.changedTouches[0].clientX,touchEndY=e.changedTouches[0].clientY;
if(touchEnd-touchStart<300&&Math.abs(touchEndX-touchStartX)<10&&Math.abs(touchEndY-touchStartY)<10){
e.preventDefault();
if(card.classList.contains('flipped')){
const link=card.querySelector('.work-link');
if(link)w.open(link.href,'_blank','noopener,noreferrer');
}else{
card.classList.add('flipped');
workCards.forEach(other=>{if(other!==card)other.classList.remove('flipped');});
}
}
},{passive:false});
});

// Performance optimizations for mobile
if(w.innerWidth<768){
const particles=qs('#particles-js');
if(particles)particles.style.display='none';
AOS.refresh({duration:600,easing:'ease-out',once:true,mirror:false});
}
}

// Keyboard navigation
const setupKeyboard=()=>{
// Hamburger keyboard
hamburger&&hamburger.addEventListener('keydown',e=>{
if(e.key==='Enter'||e.key===' '){
e.preventDefault();
const expanded=hamburger.getAttribute('aria-expanded')==='true';
hamburger.setAttribute('aria-expanded',!expanded);
navMenu&&navMenu.classList.toggle('active');
hamburger.classList.toggle('active');
}
});

// Work cards keyboard
workCards.forEach(card=>{
card.addEventListener('keydown',e=>{
if(e.key==='Enter'||e.key===' '){
e.preventDefault();
const link=card.querySelector('.work-link');
if(link)link.click();
}
});
});

// Filter buttons keyboard
filterBtns.forEach((btn,i)=>{
btn.addEventListener('keydown',e=>{
let targetIndex=i;
switch(e.key){
case 'ArrowRight':e.preventDefault();targetIndex=(i+1)%filterBtns.length;break;
case 'ArrowLeft':e.preventDefault();targetIndex=(i-1+filterBtns.length)%filterBtns.length;break;
case 'Home':e.preventDefault();targetIndex=0;break;
case 'End':e.preventDefault();targetIndex=filterBtns.length-1;break;
case 'Enter':case ' ':e.preventDefault();btn.click();return;
}
if(targetIndex!==i)filterBtns[targetIndex].focus();
});
btn.addEventListener('click',()=>{
filterBtns.forEach(b=>b.setAttribute('aria-pressed','false'));
btn.setAttribute('aria-pressed','true');
});
});

// Escape key for mobile menu
d.addEventListener('keydown',e=>{
if(e.key==='Escape'&&navMenu&&navMenu.classList.contains('active')){
navMenu.classList.remove('active');
hamburger&&hamburger.classList.remove('active')&&hamburger.setAttribute('aria-expanded','false');
hamburger&&hamburger.focus();
}
});

// Theme toggle keyboard
themeToggle&&themeToggle.addEventListener('keydown',e=>{
if(e.key==='Enter'||e.key===' '){e.preventDefault();themeToggle.click();}
});
};

setupKeyboard();
console.log('Portfolio initialized');
});

// Dynamic styles
const style=d.createElement('style');
style.textContent='.ripple{position:absolute;border-radius:50%;background:rgba(255,255,255,0.5);transform:translate(-50%,-50%);pointer-events:none;animation:ripple-effect 0.6s ease-out}@keyframes ripple-effect{from{width:0;height:0;opacity:1}to{width:300px;height:300px;opacity:0}}';
d.head.appendChild(style);